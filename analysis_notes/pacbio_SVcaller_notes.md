# Notes about the Files Generated by PacBio SV Caller

## "Old" PacBio SV Caller
### Overview
* Poplar data was first processed by Mike F. using the "old" PacBio SV caller \
around August 2018
* Samples were run through the pipeline individually first, and then run \
all together to generate a shared .vcf
### Individual Files
#### Original Location of Individual VCFs on PacBio System
* Location of each VCF found in this file: 
  * `/home/t4c1/WORK/grabowsk/data/poplar_branches/meta/pop_branch_pbSVcaller_dirs.tsv`
#### R Script to make commands to copy files to $WORK directory
```
pbSVcall_info_file <- '/home/t4c1/WORK/grabowsk/data/poplar_branches/meta/pop_branch_pbSVcaller_dirs.tsv'
pbSVcall_info <- read.table(pbSVcall_info_file, header = T, stringsAsFactors = F, sep = '\t')
rest_file_info <- '/tasks/pbsvtools.tasks.gather_vcf-1/file.vcf'
out_dir <- '/home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/old_PB_SVcaller/'
full_vcf_files <- paste(pbSVcall_info[,2], rest_file_info, sep = '')
out_vcf_files <- paste(out_dir, 'pop_branches_', pbSVcall_info[,1], '_old_PB_SVcaller_Ref14.5_v1.0.vcf', sep = '')
copy_coms <- paste('cp', full_vcf_files, out_vcf_files, sep = ' ')
top_com <- '#!/bin/bash'
tot_coms <- c(top_com, copy_coms)
sh_out_file <- paste(out_dir, 'copy_old_PB_SVcaller_14.5_individual_vcfs.sh', sep = '')
write.table(tot_coms, file = sh_out_file, quote = F, sep = '\t', row.names = F, col.names = F)
```
#### Run Shell Script
```
cd /home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/old_PB_SVcaller
bash copy_old_PB_SVcaller_14.5_individual_vcfs.sh
```
#### Location in $WORK Directory
* Found in `/home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/old_PB_SVcaller/`
* Name is `pop_branches_LIBNAME__old_PB_SVcaller_Ref14.5_v1.0.vcf`
  * ex: `pop_branches_PAXL_old_PB_SVcaller_Ref14.5_v1.0.vcf`
### Combo File
#### Original Location of VCF
* `/home/smrtlink/userdata/jobs_root.local/002/002402/tasks/pbsvtools.tasks.gather_vcf-1/file.vcf`
#### Command for copying file
```
cp /home/smrtlink/userdata/jobs_root.local/002/002402/tasks/pbsvtools.tasks.gather_vcf-1/file.vcf /home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/old_PB_SVcaller/pop_branches_combo_old_PB_SVcaller_Ref14.5_v1.0.vcf
```
#### Location in $WORK Directory
* `/home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/old_PB_SVcaller/pop_branches_combo_old_PB_SVcaller_Ref14.5_v1.0.vcf`

## 'New' PacBio SV Caller
### Overview
* PacBio introduced a new SV calling pipeline in September 2018
* Chris ran the poplar data through the new pipeline
  * He ran the samples individually and combined
### Individual Files
#### Original Location of VCF files
* `/home/f1p1/tmp/PBSV/Poplar14.5/LIBS`
#### Command for copying files to $WORK directory
```
cd /home/f1p1/tmp/PBSV/Poplar14.5/LIBS
for i in PAXL PAXN PAYK PAYZ PAZF PAZG PAZH PBAT PBAU PBAW; do cp $i'/ref.'$i'.vcf' /home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/new_PB_SVcaller; done
```
#### Location in $WORK Directory
* Found in `/home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/new_PB_SVcaller/`
* Name is: `ref.LIBNAME.vcf`
  * ex: `ref.PAXL.vcf`
### Combined VCF
#### Original Location of VCF File
* `/home/f1p1/tmp/PBSV/Poplar14.5/LIBS/ref.ALLData.vcf`
#### Command for copying file to $WORK directory
```
cp /home/f1p1/tmp/PBSV/Poplar14.5/LIBS/ref.ALLData.vcf /home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/new_PB_SVcaller
```
#### Location in $WORK directory
* `/home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/new_PB_SVcaller/ref.ALLData.vcf`

## Analysis of Samples
### Overview
* Used the New PacBio results
* Preliminary results showed unexpected relationships between samples
* Want to know:
  1. Do any samples look like they are the result of a sample switch?
  2. Which sample and/or tree looks like it is the same as the reference?
    * The reference is supposed to be 14.5, but there is some question \
about that from preliminary analysis
### Analysis script
* `/home/grabowsky/tools/workflows/poplar_branch_indels/r_scripts/pb_SV_sample_analysis.r`
### Output Files
#### Distance Matrix and Figures
* Distance Matrix
  * `/home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/new_PB_SVcaller/analysis_results/poplar_lib_manhattan_distance_50bp.txt`
  * Distance matrix made ussing filtered SV's > 50bp
* UPGMA Tree
  * `/home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/new_PB_SVcaller/analysis_results/figs/sv_dist_50bp_upgma_tree.png`
* Neighbor Joining (NJ) Tree
  * `/home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/new_PB_SVcaller/analysis_results/figs/sv_dist_50bp_nj_tree.png`
#### Difference from Reference
* Table of Percent of each genotype
  * `/home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/new_PB_SVcaller/analysis_results/percent_SV_genotypes_by_samp.txt`
  * Reference sample should have fewest ALT SVs
    * Is more complicated, but does seem that one tree, Tree 13, has fewer \
ALT SVs than the other tree
* Barplot
  * `/home/t4c1/WORK/grabowsk/data/poplar_branches/SV_calling_analysis/new_PB_SVcaller/analysis_results/figs/percent_SV_genotypes_barplot.pdf`
  * Generated using filtered SV's > 50bp



